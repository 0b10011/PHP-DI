<!DOCTYPE html>
<!--[if lt IE 7]>
<html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>
<html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>
<html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">

    <title>PHP-DI - The Dependency Injection Container for humans</title>
    <meta name="description" content="PHP-DI is a Dependency Injection Container for PHP that intends to be practical and powerful">

            <link href="http://php-di.org/css/bootstrap-theme_venera.min.css" media="all" rel="stylesheet" type="text/css">
        <link href="http://fonts.googleapis.com/css?family=Abel:400|Oswald:300,400,700" media="all" rel="stylesheet" type="text/css">
        <link href="http://php-di.org/css/highlight.github.css" rel="stylesheet">
        <link href="http://php-di.org/css/custom.css" rel="stylesheet">
    </head>
<body>

    <header id='header'>
        <div class='navbar navbar-fixed-top'>
            <div class='navbar-inner'>
                <div class='container'>
                    <a class='btn btn-navbar' data-target='.nav-collapse' data-toggle='collapse'>
                        <span class='icon-bar'></span>
                        <span class='icon-bar'></span>
                        <span class='icon-bar'></span>
                    </a>
                    <a href="http://php-di.org/index.html" class="brand">PHP-DI</a>

                    <div class='nav-collapse subnav-collapse collapse pull-right' id='top-navigation'>
                        <ul class='nav'>
                            <li><a href="http://php-di.org/">Home</a></li>
                            <li><a href="http://php-di.org/news/">News</a></li>
                            <li><a href="http://php-di.org/doc/getting-started.html">Getting started</a></li>
                            <li><a href="http://php-di.org/doc/">Documentation</a></li>
                            <li><a href="http://php-di.org/change-log.html">Change log</a></li>
                            <li><a href="https://github.com/mnapoli/PHP-DI"><i class="icon-github"></i> Github</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </header>

    
    <header class="jumbotron subhead" id="overview">
        <div class="container">
            <div class="docs-header-icon">
                <h1>Documentation</h1>
                <p class="lead">
                    This is the documentation for PHP-DI 4. The documentation for v3 is
                    <a href="https://github.com/mnapoli/PHP-DI/tree/3.x/doc">still available here</a>.
                </p>
            </div>
        </div>
    </header>
    <div class='sub-jumbotron'>
        <div class='container'>
            <ul>
                <li>
                    <a href="/doc/" class="">Full documentation</a>
                </li>
                <li>
                    <a href="/doc/getting-started.html" class="">Getting started</a>
                </li>
                <li>
                    <a href="/doc/best-practices.html" class="">Best practices</a>
                </li>
                <li>
                    <a href="/doc/container-configuration.html" class="">Configuring the container</a>
                </li>
                <li>
                    <a href="/doc/definition.html" class="">Defining injections</a>
                </li>
            </ul>
        </div>
    </div>

    <div class="container docs-w">
        <h1>Migrating from PHP-DI 3.x to 4.0</h1>
<p>PHP-DI 4.0 is a new major version that comes with backward compatibility breaks.</p>
<p>This guide will (hopefully) help you migrate from a 3.x version to 4.0.</p>
<h2>Definitions</h2>
<p>The biggest BC break is between the definitions format. The new definition format is very different from the old one,
because it is based on function helpers, not an array or YAML structure.</p>
<p>To be clear: YAML configuration is not supported anymore.</p>
<p>Here is a comparison:</p>
<pre><code class="language-php">// Before
return [
    'My\Class' =&gt; [
        'constructor' =&gt; [
            'host' =&gt; 'db.host',
            'port' =&gt; 'db.port',
        ],
        'methods' =&gt; [
            'setFoo' =&gt; [ 'My\Foo' ],
        ],
    ],
];

// After
return [
    'My\Class' =&gt; DI\object()
        -&gt;constructor(DI\link('db.host'), DI\link('db.port'))
        -&gt;method('setFoo', DI\link('My\Foo'))
];</code></pre>
<p>You may or may not like this choice, but this is the conclusion of a lot of thinking and trials.
If you are interested, you can read more here: <a href="https://gist.github.com/mnapoli/6890585">Thoughts about PHP-DI 4.0</a>,
the main reason is that offering a YAML DSL is very restrictive over what we can do with PHP code,
mainly <strong>closures</strong>.</p>
<p>We actually recommend that any complex definition should be written in PHP code using an anonymous function:</p>
<pre><code class="language-php">return [
    MyClass::class =&gt; DI\factory(function (ContainerInterface $c) {
        $o = new MyClass($c-&gt;get('db.host'), $c-&gt;get('db.port'));
        $o-&gt;setFoo($c-&gt;get(Foo::class));
        return $o;
    })
];</code></pre>
<p>Using real PHP code is of course better, because it's easier to maintain, it is less tied to PHP-DI and it's
not limited by an API.</p>
<p>On the other hand, the helper functions are helpful if you are writing a simple definition.</p>
<h2>Creating the container</h2>
<p>You are encouraged to use the <code>ContainerBuilder</code> to create the <code>Container</code> if you weren't already doing this.</p>
<p>The API of the <code>ContainerBuilder</code> has changed a bit:</p>
<ul>
<li><code>setDefinitionsValidation</code> has been removed (since it's PHP code it's validated by PHP)</li>
<li><code>addDefinitionsFromFile</code> is now <code>addDefinitions</code> and now takes a file name (simpler)</li>
<li><code>useReflection</code> is now <code>useAutowiring</code></li>
</ul>
<h2>Lazy injection and proxies</h2>
<p>The way lazy injection and proxies work has been greatly simplified.</p>
<p>Now it is pretty simple: to use lazy injection, <strong>you have to define an entry as "lazy"</strong>.</p>
<p>You can <strong>no longer</strong> request a proxy using <code>$container-&gt;get('my.entry', $lazy = true)</code>, or with annotations:</p>
<pre><code class="language-php">class Example {
    /**
     * @Inject(lazy=true)
     * @var Foo
     */
    protected $property1;
}</code></pre>
<p>You can now do this:</p>
<pre><code class="language-php">/**
 * @Injectable(lazy=true)
 */
class Foo {
}</code></pre>
<p>Or</p>
<pre><code class="language-php">&lt;?php

return [
    'foo' =&gt; DI\object('MyClass')
        -&gt;lazy(),
];</code></pre>
<p>Read more in the <a href="../lazy-injection.html">lazy injection documentation</a>.</p>
    </div>


            <footer>
            <div class='pre-footer'>
                <div class='container'>
                    <p>
                        <strong>Unsatisfied with the documentation?</strong>
                        Please let us know, <a href="https://github.com/mnapoli/PHP-DI/issues/new">create an issue</a>,
                        we will greatly appreciate it.
                        You can chat with us on
                        <a href="https://twitter.com/phpdi">Twitter</a> or
                        <a href="https://gitter.im/mnapoli/PHP-DI">Gitter chat</a> too.
                    </p>
                </div>
            </div>
            <div class='deep-footer'>
                <div class='container'>
                    <div class='copyright'>
                        Copyright &copy; 2014 <a href="http://mnapoli.fr/">Matthieu Napoli</a>
                        Website generated with
                        <a href="http://mnapoli.fr/Couscous/" target="_blank">Couscous</a>.
                    </div>
                </div>
            </div>
        </footer>
    
            <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
        <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js" type="text/javascript"></script>
        <script src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>
        <script src="http://php-di.org/js/template.js"></script>

        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');
                $("section>p:first-child").addClass('lead');
                hljs.initHighlightingOnLoad();
            });
        </script>
    
    <script>
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-15584647-13']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</body>
</html>
