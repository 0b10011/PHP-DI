<!DOCTYPE html>
<!--[if lt IE 7]>
<html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>
<html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>
<html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">

    <title>PHP-DI - The Dependency Injection Container for humans</title>
    <meta name="description" content="PHP-DI is a Dependency Injection Container for PHP that intends to be practical and powerful">

            <link href="http://php-di.org/css/bootstrap-theme_venera.min.css" media="all" rel="stylesheet" type="text/css">
        <link href="http://fonts.googleapis.com/css?family=Abel:400|Oswald:300,400,700" media="all" rel="stylesheet" type="text/css">
        <link href="http://php-di.org/css/highlight.github.css" rel="stylesheet">
        <link href="http://php-di.org/css/custom.css" rel="stylesheet">
    </head>
<body>

    <header id='header'>
        <div class='navbar navbar-fixed-top'>
            <div class='navbar-inner'>
                <div class='container'>
                    <a class='btn btn-navbar' data-target='.nav-collapse' data-toggle='collapse'>
                        <span class='icon-bar'></span>
                        <span class='icon-bar'></span>
                        <span class='icon-bar'></span>
                    </a>
                    <a href="http://php-di.org/index.html" class="brand">PHP-DI</a>

                    <div class='nav-collapse subnav-collapse collapse pull-right' id='top-navigation'>
                        <ul class='nav'>
                            <li><a href="http://php-di.org/">Home</a></li>
                            <li><a href="http://php-di.org/news/">News</a></li>
                            <li><a href="http://php-di.org/doc/getting-started.html">Getting started</a></li>
                            <li><a href="http://php-di.org/doc/">Documentation</a></li>
                            <li><a href="http://php-di.org/change-log.html">Change log</a></li>
                            <li><a href="https://github.com/mnapoli/PHP-DI"><i class="icon-github"></i> Github</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </header>

    
    <header class="jumbotron subhead" id="overview">
        <div class="container">
            <div class="docs-header-icon">
                <h1>Documentation</h1>
                <p class="lead">
                    This is the documentation for PHP-DI 4. The documentation for v3 is
                    <a href="https://github.com/mnapoli/PHP-DI/tree/3.x/doc">still available here</a>.
                </p>
            </div>
        </div>
    </header>
    <div class='sub-jumbotron'>
        <div class='container'>
            <ul>
                <li>
                    <a href="/doc/" class="">Full documentation</a>
                </li>
                <li>
                    <a href="/doc/getting-started.html" class="">Getting started</a>
                </li>
                <li>
                    <a href="/doc/best-practices.html" class="">Best practices</a>
                </li>
                <li>
                    <a href="/doc/container-configuration.html" class="">Configuring the container</a>
                </li>
                <li>
                    <a href="/doc/definition.html" class="active">Defining injections</a>
                </li>
            </ul>
        </div>
    </div>

    <div class="container docs-w">
        <h1>Definitions</h1>
<p>PHP-DI injects stuff into objects.</p>
<p>To <strong>define</strong> where and how to inject stuff, you have several options:</p>
<ul>
<li>use autowiring: let PHP-DI guess using <a href="http://www.php.net/manual/en/book.reflection.php">Reflection</a></li>
<li>use annotations</li>
<li>use PHP configuration</li>
</ul>
<p>You can also use several or all these options at the same time if you want to.</p>
<p>If you combine several sources, there are priorities that apply. From the highest priority to the least:</p>
<ul>
<li>Explicit definition on the container (i.e. defined with <code>$container-&gt;set()</code>)</li>
<li>PHP file definitions (if you add several configuration files, then the last one can override entries from the previous ones)</li>
<li>Annotations</li>
<li>Autowiring</li>
</ul>
<p>Read more in the <a href="definition-overriding.html">Definition overriding documentation</a></p>
<h2>Autowiring</h2>
<pre><code class="language-php">$container-&gt;useAutowiring(true);</code></pre>
<p><strong>Note: autowiring is enabled by default</strong></p>
<p>This solution is the simplest, but also restricted.</p>
<p>Example:</p>
<pre><code class="language-php">class Foo {
    public function __construct(Bar $param1) {
    }
}</code></pre>
<p>When creating a new <code>Foo</code> instance, the constructor has to be called. So PHP-DI will look at the parameters and guess: <em><code>$param1</code> must be an instance of <code>Bar</code></em> (that's <a href="http://www.php.net/manual/en/language.oop5.typehinting.php">type hinting</a>).</p>
<p>Simple! And it works!</p>
<p>However, PHP-DI won't be able to resolve cases like this:</p>
<pre><code class="language-php">class Foo {
    public function __construct($param1, $param2) {
    }
    public function setStuff($stuff) {
    }
}</code></pre>
<p>It will not know what parameters to give to the constructor, and <code>setStuff()</code> will not be called.</p>
<p>So use autowiring either:</p>
<ul>
<li>if you also use other definition options (annotations, file configuration…)</li>
<li>if you only need constructor injection, and if you always use type-hinting</li>
</ul>
<h2>Annotations</h2>
<pre><code class="language-php">$container-&gt;useAnnotations(true);</code></pre>
<p><strong>Note: Annotations are enabled by default</strong></p>
<p>Annotations are written in PHP docblock comments. They are used by a lot of modern libraries and frameworks, like <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/index.html">Doctrine</a>, <a href="http://symfony.com/">Symfony</a>, <a href="http://flow.typo3.org/">Flow</a>, <a href="http://www.phpunit.de/manual/3.7/en/">PHPUnit</a>…</p>
<p><code>@Inject</code> let's you define where PHP-DI should inject stuff, and what should it inject. You can also use <code>@var</code> and <code>@param</code> PhpDoc tags to define what should be injected.</p>
<p>It can be used over:</p>
<ul>
<li>the constructor (constructor injection)</li>
<li>setters (setter injection) or any method actually</li>
<li>properties (property injection)</li>
</ul>
<p>Here is an example of all possible uses of the <code>@Inject</code> annotation:</p>
<pre><code class="language-php">class Example {
    /**
     * @Inject
     * @var Foo
     */
    protected $property1;
    /**
     * @Inject("db.host")
     */
    protected $property2;

    /**
     * @Inject
     * @param Foo $param1
     * @param Bar $param2
     */
    public function __construct($param1, $param2) {
    }

    /**
     * @Inject
     */
    public function method1(Foo $param) {
    }

    /**
     * @Inject({"db.host", "db.name"})
     */
    public function method2($param1, $param2) {
    }
}</code></pre>
<p><em>Note</em>: importing annotations with <code>use DI\Annotation\Inject;</code> is optional since v3.5.</p>
<p>The <code>@Injectable</code> annotation let's you set options on injectable classes:</p>
<pre><code class="language-php">/**
 * @Injectable(scope="prototype", lazy=true)
 */
class Example {
}</code></pre>
<p><strong>The <code>@Injectable</code> annotation is optional: by default, all classes are injectable.</strong></p>
<p>There are still things that can't be defined with annotations:</p>
<ul>
<li>values (instead of classes)</li>
<li>mapping interfaces to implementations</li>
<li>defining entries with an anonymous function</li>
</ul>
<p>For that, you can combine annotations with definitions in PHP (see below).</p>
<h2>PHP configuration</h2>
<p>You can define injections with a PHP array:</p>
<pre><code class="language-php">$containerBuilder-&gt;addDefinitions('config.php');</code></pre>
<p>This definition format is the most powerful of all, but also more verbose.
There are several kind of <strong>entries</strong> you can define:</p>
<ul>
<li><strong>value</strong>: string, int, array, class instance, …</li>
<li><strong>object</strong>: you describe to the container <em>how</em> it will create an instance of a class</li>
<li><strong>factory</strong>: a <code>callable</code> (function) that will return the entry</li>
<li><strong>alias</strong>: alias an entry name to another entry name</li>
</ul>
<p>PHP-DI provides function helpers for this (to define <em>values</em>, you don't need a function):</p>
<ul>
<li><code>DI\object($classname = null)</code>: define an object entry</li>
<li><code>DI\factory($factory)</code>: define a factory that returns an entry</li>
<li><code>DI\link($entryName)</code>: used to define alias entries, and also to reference other entries in object definitions (see below)</li>
</ul>
<p>Example of a <code>config.php</code> file (using <a href="http://php.net/manual/en/migration54.new-features.php">PHP 5.4 short arrays</a>):</p>
<pre><code class="language-php">&lt;?php

return [

    // Values (not classes)
    'db.host'           =&gt; 'localhost',
    'db.port'           =&gt; 5000,
    'report.recipients' =&gt; [
        'bob@acme.example.com',
        'alice@acme.example.com'
    ],

    // Explicit definition of an object (unnecessary if you use autowiring)
    'SomeClass' =&gt; DI\object(),

    // Value definition of a class instance
    // Not recommended: will instantiate the class on every request, even when not used
    'SomeOtherClass' =&gt; new SomeOtherClass(1, "hello"),

    // Defines an instance of My\Class
    'My\Class' =&gt; DI\object()
        -&gt;constructor(DI\link('db.host'), DI\link('My\OtherClass')),

    'My\OtherClass' =&gt; DI\object()
        -&gt;scope(Scope::PROTOTYPE())
        -&gt;constructor(DI\link('db.host'), DI\link('db.port'))
        -&gt;method('setFoo2', DI\link('My\Foo1'), DI\link('My\Foo2'))
        -&gt;property('bar', 'My\Bar'),

    // Define only specific parameters
    'My\AnotherClass' =&gt; DI\object()
        -&gt;constructorParameter('someParam', 'value to inject')
        -&gt;methodParameter('setFoo2', 'someParam', DI\link('My\Foo')),

    // Mapping an interface to an implementation
    'My\Interface' =&gt; DI\object('My\Implementation'),

    // Defining a named instance
    'myNamedInstance' =&gt; DI\object('My\Class'),

    // Using an anonymous function
    'My\Stuff' =&gt; DI\factory(function (Container $c) {
        return new MyClass($c-&gt;get('db.host'));
    }),

    // Defining an alias to another entry
    'some.entry' =&gt; DI\link('some.other.entry'),

];</code></pre>
<p>In addition to defining entries in an array, you can set them directly in the container as shown below.
<strong>Using an array is however recommended since it allows to cache the definitions.</strong></p>
<pre><code class="language-php">// Value
$container-&gt;set('db.host', 'localhost');

// Object
$container-&gt;set('My\Class', \DI\object()
    -&gt;constructor('some raw value'))
);

// ...</code></pre>
<p>The API is the same as shown above for the PHP array containing definitions.</p>
    </div>


            <footer>
            <div class='pre-footer'>
                <div class='container'>
                    <p>
                        <strong>Unsatisfied with the documentation?</strong>
                        Please let us know, <a href="https://github.com/mnapoli/PHP-DI/issues/new">create an issue</a>,
                        we will greatly appreciate it.
                        You can chat with us on
                        <a href="https://twitter.com/phpdi">Twitter</a> or
                        <a href="https://gitter.im/mnapoli/PHP-DI">Gitter chat</a> too.
                    </p>
                </div>
            </div>
            <div class='deep-footer'>
                <div class='container'>
                    <div class='copyright'>
                        Copyright &copy; 2014 <a href="http://mnapoli.fr/">Matthieu Napoli</a>
                        Website generated with
                        <a href="http://mnapoli.fr/Couscous/" target="_blank">Couscous</a>.
                    </div>
                </div>
            </div>
        </footer>
    
            <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
        <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js" type="text/javascript"></script>
        <script src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>
        <script src="http://php-di.org/js/template.js"></script>

        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');
                $("section>p:first-child").addClass('lead');
                hljs.initHighlightingOnLoad();
            });
        </script>
    
    <script>
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-15584647-13']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</body>
</html>
