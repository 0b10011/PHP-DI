<!DOCTYPE html>
<!--[if lt IE 7]>
<html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>
<html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>
<html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">

    <title>PHP-DI - The Dependency Injection Container for humans</title>
    <meta name="description" content="PHP-DI is a Dependency Injection Container for PHP that intends to be practical and powerful">

            <link href="http://php-di.org/css/bootstrap-theme_venera.min.css" media="all" rel="stylesheet" type="text/css">
        <link href="http://fonts.googleapis.com/css?family=Abel:400|Oswald:300,400,700" media="all" rel="stylesheet" type="text/css">
        <link href="http://php-di.org/css/highlight.github.css" rel="stylesheet">
        <link href="http://php-di.org/css/custom.css" rel="stylesheet">
    </head>
<body>

    <header id='header'>
        <div class='navbar navbar-fixed-top'>
            <div class='navbar-inner'>
                <div class='container'>
                    <a class='btn btn-navbar' data-target='.nav-collapse' data-toggle='collapse'>
                        <span class='icon-bar'></span>
                        <span class='icon-bar'></span>
                        <span class='icon-bar'></span>
                    </a>
                    <a href="http://php-di.org/index.html" class="brand">PHP-DI</a>

                    <div class='nav-collapse subnav-collapse collapse pull-right' id='top-navigation'>
                        <ul class='nav'>
                            <li><a href="http://php-di.org/">Home</a></li>
                            <li><a href="http://php-di.org/news/">News</a></li>
                            <li><a href="http://php-di.org/doc/getting-started.html">Getting started</a></li>
                            <li><a href="http://php-di.org/doc/">Documentation</a></li>
                            <li><a href="http://php-di.org/change-log.html">Change log</a></li>
                            <li><a href="https://github.com/mnapoli/PHP-DI"><i class="icon-github"></i> Github</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </header>

    
    <header class="jumbotron subhead" id="overview">
        <div class="container">
            <div class="docs-header-icon">
                <h1>Documentation</h1>
                <p class="lead">
                    This is the documentation for PHP-DI 4. The documentation for v3 is
                    <a href="https://github.com/mnapoli/PHP-DI/tree/3.x/doc">still available here</a>.
                </p>
            </div>
        </div>
    </header>
    <div class='sub-jumbotron'>
        <div class='container'>
            <ul>
                <li>
                    <a href="/doc/" class="">Full documentation</a>
                </li>
                <li>
                    <a href="/doc/getting-started.html" class="">Getting started</a>
                </li>
                <li>
                    <a href="/doc/best-practices.html" class="">Best practices</a>
                </li>
                <li>
                    <a href="/doc/container-configuration.html" class="">Configuring the container</a>
                </li>
                <li>
                    <a href="/doc/container.html" class="">Using the container</a>
                </li>
                <li>
                    <a href="/doc/definition.html" class="">Defining injections</a>
                </li>
            </ul>
        </div>
    </div>

    <div class="container docs-w">
        <h1>PHP-DI in Zend Framework 1</h1>
<h2>Set up</h2>
<p>If you are using ZF1, PHP-DI provides easy and clean integration so that you don't have
to call the container (thus avoiding the Service Locator pattern).</p>
<p>First, install the bridge to ZF1:</p>
<pre><code class="language-json">{
    "require": {
        "mnapoli/php-di": "The version you want here",
        "mnapoli/php-di-zf1": "*"
    }
}</code></pre>
<p>To use PHP-DI in your ZF1 application, you need to change the Dispatcher used by the Front Controller in the Bootstrap.</p>
<pre><code class="language-php">    protected function _initContainer() {
        $builder = new \DI\ContainerBuilder();
        $container = $builder-&gt;build();

        $dispatcher = new \DI\ZendFramework1\Dispatcher();
        $dispatcher-&gt;setContainer($container);

        Zend_Controller_Front::getInstance()-&gt;setDispatcher($dispatcher);
    }</code></pre>
<p>That's it!</p>
<p><strong>Warning</strong>: if you use Zend's autoloader (and not Composer), you will need to configure it:</p>
<pre><code class="language-php">$autoloader-&gt;suppressNotFoundWarnings(true);</code></pre>
<h2>Usage</h2>
<p>Now you can inject dependencies in your controllers!</p>
<p>For example, here is the GuestbookController of the quickstart:</p>
<pre><code class="language-php">class GuestbookController extends Zend_Controller_Action
{
    /**
     * This dependency will be injected by PHP-DI
     * @Inject
     * @var Application_Service_GuestbookService
     */
    private $guestbookService;

    public function indexAction()
    {
        $this-&gt;view-&gt;entries = $this-&gt;guestbookService-&gt;getAllEntries();
    }
}</code></pre>
<h2>Recommended layout</h2>
<p>Here is a recommended layout for your configuration:</p>
<pre><code>application/
    configs/
        application.ini          # ZF config
        config.php               # DI config
        config.development.php   # DI config for development
        config.production.php    # DI config for production
        parameters.php           # Local parameters (DB password, â€¦) -&gt; Don't commit this file
        parameters.php.default   # Template for parameters.php -&gt; Commit this file
    Bootstrap.php</code></pre>
<p>Here is an example of the full Bootstrap method:</p>
<pre><code class="language-php">    protected function _initContainer()
    {
        $configuration = new Zend_Config($this-&gt;getOptions());

        $builder = new ContainerBuilder();
        $builder-&gt;addDefinitions(APPLICATION_PATH . '/configs/config.php');
        $builder-&gt;addDefinitions(APPLICATION_PATH . '/configs/config.' . APPLICATION_ENV . '.php');
        $builder-&gt;addDefinitions(APPLICATION_PATH . '/configs/parameters.php');

        if (APPLICATION_ENV === 'production') {
            $cache = new MemcachedCache();
            $memcached = new Memcached();
            $memcached-&gt;addServer('localhost', 11211);
            $cache-&gt;setMemcached($memcached);
        } else {
            $cache = new ArrayCache();
        }
        $cache-&gt;setNamespace('MyApp');
        $builder-&gt;setDefinitionCache($cache);

        $this-&gt;container = $builder-&gt;build();

        $dispatcher = new \DI\Bridge\ZendFramework1\Dispatcher();
        $dispatcher-&gt;setContainer($this-&gt;container);
        Zend_Controller_Front::getInstance()-&gt;setDispatcher($dispatcher);
    }</code></pre>
<p>You are not required to follow it of course.</p>
<h2>Tests</h2>
<p>Zend Framework 1 provides <a href="http://framework.zend.com/manual/1.12/en/zend.test.phpunit.html">a base class to test controllers</a>.
If you are using this base class, and you want to have full control on the dependencies that will be injected
inside the controller you are testing (for example to inject <strong>mocks</strong>), here is a recommended approach:</p>
<pre><code class="language-php">class UserControllerTest extends Zend_Test_PHPUnit_ControllerTestCase
{
    private $container;

    public function setUp()
    {
        $this-&gt;bootstrap = array($this, 'appBootstrap');
        parent::setUp();
    }

    public function appBootstrap()
    {
        $builder = new ContainerBuilder();
        // Configure your container here
        $builder-&gt;addDefinitions(__DIR__ . '/../../application/config/config.php');
        $this-&gt;container = $builder-&gt;build();

        $dispatcher = new \DI\Bridge\ZendFramework1\Dispatcher();
        $dispatcher-&gt;setContainer($this-&gt;container);

        $this-&gt;frontController-&gt;setDispatcher($dispatcher);
    }

    public function testCallWithoutActionShouldPullFromIndexAction()
    {
        // Here I can override the dependencies that will be injected
        $fakeEntityManager = $this-&gt;getMock(...);
        $this-&gt;container-&gt;set('Doctrine\ORM\EntityManager', $fakeEntityManager);

        $this-&gt;dispatch('/user');
        $this-&gt;assertController('user');
        $this-&gt;assertAction('index');
    }
}</code></pre>
<p>How it works: a new container is created for each test, which ensures that whatever you do
with the container in one test will not affect the others.</p>
<p>Obviously, the <code>setUp()</code> and <code>appBootstrap()</code> methods could go in a base abstract class.</p>
<h2>More</h2>
<p>Read more on the <a href="https://github.com/mnapoli/PHP-DI-ZF1">PHP-DI-ZF1 project on Github</a>.</p>
    </div>


            <footer>
            <div class='pre-footer'>
                <div class='container'>
                    <p>
                        <strong>Unsatisfied with the documentation?</strong>
                        Please let us know, <a href="https://github.com/mnapoli/PHP-DI/issues/new">create an issue</a>,
                        we will greatly appreciate it.
                        You can chat with us on
                        <a href="https://twitter.com/phpdi">Twitter</a> or
                        <a href="https://gitter.im/mnapoli/PHP-DI">Gitter chat</a> too.
                    </p>
                </div>
            </div>
            <div class='deep-footer'>
                <div class='container'>
                    <div class='copyright'>
                        Copyright &copy; 2014 <a href="http://mnapoli.fr/">Matthieu Napoli</a>
                        Website generated with
                        <a href="http://mnapoli.fr/Couscous/" target="_blank">Couscous</a>.
                    </div>
                </div>
            </div>
        </footer>
    
            <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
        <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js" type="text/javascript"></script>
        <script src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>
        <script src="http://php-di.org/js/template.js"></script>

        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');
                $("section>p:first-child").addClass('lead');
                hljs.initHighlightingOnLoad();
            });
        </script>
    
    <script>
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-15584647-13']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</body>
</html>
